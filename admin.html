
<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard</title>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAPVRH8VPPdhGVMF6NZFs7SXFUDVADpmg8",
  authDomain: "shreevarisnacks-45d0d.firebaseapp.com",
  projectId: "shreevarisnacks-45d0d",
  storageBucket: "shreevarisnacks-45d0d.firebasestorage.app",
  messagingSenderId: "834301462418",
  appId: "1:834301462418:web:291d73b35f0b6c3d96634b"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// Protect page
onAuthStateChanged(auth, (user) => {
  if (!user) {
    window.location.href = "login.html"; // redirect if not logged in
  }
});
</script>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
<script>
firebase.auth().onAuthStateChanged(user => {
  if(!user){
    window.location.href = "login.html";
  }
});
</script>
<script type="module">

// Firebase SDK
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

// Config
const firebaseConfig = {
  apiKey: "AIzaSyAPVRH8VPPdhGVMF6NZFs7SXFUDVADpmg8",
  authDomain: "shreevarisnacks-45d0d.firebaseapp.com",
  projectId: "shreevarisnacks-45d0d",
  storageBucket: "shreevarisnacks-45d0d.firebasestorage.app",
  messagingSenderId: "834301462418",
  appId: "1:834301462418:web:291d73b35f0b6c3d96634b"
};

// Init
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// Form Inputs (IMPORTANT)
const form = document.getElementById("menuForm");

const nameInput = document.getElementById("name");
const priceInput = document.getElementById("price");
const categoryInput = document.getElementById("category");
const imageInput = document.getElementById("image");

const list = document.getElementById("menuList");


// Add Item
form.addEventListener("submit", async (e) => {

  e.preventDefault();

  const name = nameInput.value.trim();
  const price = priceInput.value;
  const category = categoryInput.value;
  const file = imageInput.files[0];

  if (!name || !price) {
    alert("Fill all fields");
    return;
  }

  let imageUrl = "";

  try {

    // Upload Image
    if (file) {
      const imgRef = ref(storage, "menu/" + Date.now());
      await uploadBytes(imgRef, file);
      imageUrl = await getDownloadURL(imgRef);
    }

    // Save Firestore
    await addDoc(collection(db, "menu"), {
      name,
      price: Number(price),
      category,
      image: imageUrl,
      created: new Date()
    });

    alert("Item Added Successfully ✅");

    form.reset();
    loadMenu();

  } catch (err) {

    console.error(err);
    alert("Error: " + err.message);

  }

});


// Load Menu
async function loadMenu() {

  list.innerHTML = "";

  const snap = await getDocs(collection(db, "menu"));

  snap.forEach((docu) => {

    const d = docu.data();

    list.innerHTML += `
      <div style="border:1px solid #ddd;padding:10px;margin-bottom:8px;display:flex;justify-content:space-between">

        <div>
          <b>${d.name}</b><br>
          ₹${d.price} | ${d.category}
        </div>

        <button onclick="deleteItem('${docu.id}')" 
        style="color:red">
          Delete
        </button>

      </div>
    `;
  });
}


// Delete
window.deleteItem = async (id) => {

  if (!confirm("Delete this item?")) return;

  await deleteDoc(doc(db, "menu", id));

  loadMenu();
};


// First Load
loadMenu();

</script>

</head>
<body class="bg-gray-100">

<h1 class="text-2xl font-bold p-4 bg-red-600 text-white">
Admin Dashboard
</h1>

<h2 class="text-2xl font-bold mb-4">Manage Menu</h2>

<form id="menuForm" class="space-y-3 max-w-md">

  <input id="name" placeholder="Item Name" class="border p-2 w-full" required>

  <input id="price" type="number" placeholder="Price" class="border p-2 w-full" required>

  <select id="category" class="border p-2 w-full">
    <option>pizza</option>
    <option>burger</option>
    <option>sandwich</option>
    <option>milkshake</option>
    <option>mocktail</option>
    <option>maggie</option>
    <option>more</option>
  </select>

  <input type="file" id="image" accept="image/*">

  <button class="bg-green-600 text-white px-4 py-2 rounded">
    Save Item
  </button>

</form>

<hr class="my-6">

<div id="menuList"></div>


<div class="p-4">

<h2 class="font-bold mt-6 mb-2">Home Page Offer</h2>

<input id="offerText" placeholder="New Offer"
class="border p-2 w-full mb-2">

<button onclick="updateOffer()"
class="bg-blue-600 text-white px-4 py-2 rounded">
Update Offer
</button>

<button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded">
  Logout
</button>

</div>

<script src="js/admin.js"></script>
<script type="module">
import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const auth = getAuth();

window.logout = function () {
  signOut(auth).then(() => {
    window.location.href = "login.html";
  });
};
</script>

</body>
</html>
